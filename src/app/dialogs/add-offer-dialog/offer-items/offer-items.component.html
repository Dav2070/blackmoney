<div class="tab-content">
	@if (isSpecialMode) {
		<!-- Special Mode: Nur Produktauswahl f체r das eine Item -->
		<h4>{{ locale.selectProducts }}</h4>

		@if (offerItems.length > 0) {
			<div class="dialog-formfield-container">
				<div class="categories-list">
					@for (
						category of getProductsByCategory();
						track category.categoryUuid
					) {
						<div class="category-section">
							<button
								type="button"
								class="category-header"
								(click)="toggleCategory(category.categoryUuid)"
							>
								<fa-icon
									[icon]="
										isCategoryExpanded(category.categoryUuid)
											? faChevronDown
											: faChevronRight
									"
									class="chevron-icon"
								></fa-icon>
								<span class="category-name">{{
									category.categoryName
								}}</span>
								<span class="category-count"
									>({{ category.products.length }})</span
								>
							</button>

							@if (isCategoryExpanded(category.categoryUuid)) {
								<div class="products-grid">
									@for (
										product of category.products;
										track product.uuid
									) {
										<label class="product-checkbox">
											<input
												type="checkbox"
												[checked]="
													isProductSelectedForItem(
														offerItems[0],
														product
													)
												"
												(change)="
													toggleProductSelectionForItem(
														offerItems[0],
														product
													)
												"
												[disabled]="loading"
											/>
											<span>{{ product.name }}</span>
										</label>
									}
								</div>
							}
						</div>
					}
				</div>
			</div>

			<!-- Ausgew채hlte Produkte anzeigen -->
			@if (offerItems[0].products.length > 0) {
				<div class="selected-products">
					<h5>{{ locale.selectedProducts }}</h5>
					<div class="item-products">
						@for (product of offerItems[0].products; track product.uuid) {
							<span class="product-chip">{{ product.name }}</span>
						}
					</div>
				</div>
			}
		}
	} @else {
		<!-- Men체 Mode: Normale Item-Verwaltung -->
		<h4>{{ locale.offerItems }}</h4>

		<!-- Existing Items -->
		@if (offerItems.length > 0) {
			<div class="items-list">
				@for (item of offerItems; track item.uuid) {
					<div class="item-card">
						<div class="item-header">
							<div class="item-info">
								<strong>{{ item.name }}</strong>
								<span class="item-meta"
									>Max. {{ item.maxSelections }} ausw채hlbar</span
								>
							</div>
							<dav-icon-button size="xs" (click)="removeOfferItem(item)">
								<fa-icon [icon]="faTrash"></fa-icon>
							</dav-icon-button>
						</div>
						<div class="item-products">
							@for (product of item.products; track product.uuid) {
								<span class="product-chip">{{ product.name }}</span>
							}
						</div>
					</div>
				}
			</div>
		}

		<!-- Add New Item -->
		<div class="add-item-section">
			<h5>{{ locale.addNewItem }}</h5>

			<div class="dialog-formfield-container">
				<dav-textfield
					[value]="newItemName"
					[label]="locale.itemName"
					[disabled]="loading"
					[errorMessage]="newItemNameError"
					(change)="newItemNameChange($any($event).detail.value)"
				></dav-textfield>
			</div>

			<div class="dialog-formfield-container">
				<dav-textfield
					[value]="newItemMaxSelections.toString()"
					[label]="locale.maxSelections"
					[disabled]="loading"
					type="number"
					min="1"
					(change)="newItemMaxSelectionsChange($any($event).detail.value)"
				></dav-textfield>
			</div>

			<div class="dialog-formfield-container">
				<label class="form-label">{{ locale.selectProducts }}</label>
				<div class="categories-list">
					@for (
						category of getProductsByCategory();
						track category.categoryUuid
					) {
						<div class="category-section">
							<button
								type="button"
								class="category-header"
								(click)="toggleCategory(category.categoryUuid)"
							>
								<fa-icon
									[icon]="
										isCategoryExpanded(category.categoryUuid)
											? faChevronDown
											: faChevronRight
									"
									class="chevron-icon"
								></fa-icon>
								<span class="category-name">{{
									category.categoryName
								}}</span>
								<span class="category-count"
									>({{ category.products.length }})</span
								>
							</button>
							@if (isCategoryExpanded(category.categoryUuid)) {
								<div class="products-grid">
									@for (
										product of category.products;
										track product.uuid
									) {
										<label class="product-checkbox">
											<input
												type="checkbox"
												[checked]="isProductSelected(product)"
												(change)="toggleProductSelection(product)"
											/>
											<span>{{ product.name }}</span>
										</label>
									}
								</div>
							}
						</div>
					}
				</div>
			</div>

			<dav-button
				type="button"
				[disabled]="loading"
				(click)="addOfferItem()"
			>
				{{ locale.addItem }}
			</dav-button>
		</div>
	}
</div>
