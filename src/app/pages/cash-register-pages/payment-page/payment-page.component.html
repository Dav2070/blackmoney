<div class="container slide-up-in">
	<div class="orders-price-container">
		<div class="orders-container">
			@if (table != null) {
				<app-headline
					[headline]="
						locale.tableHeadline.replace('{name}', table.name.toString())
					"
					[showBackButton]="true"
					(backButtonClick)="navigateToBookingPage($event)"
				></app-headline>
			}

			<ul class="order-items-container">
				@if (ordersLoading) {
					<dav-skeleton class="order-item-card-skeleton"></dav-skeleton>
					<dav-skeleton class="order-item-card-skeleton"></dav-skeleton>
					<dav-skeleton class="order-item-card-skeleton"></dav-skeleton>
					<dav-skeleton class="order-item-card-skeleton"></dav-skeleton>
					<dav-skeleton class="order-item-card-skeleton"></dav-skeleton>
				}

				@if (!ordersLoading && bookedItems.getOrderItems().length === 0) {
					<p class="no-products-message">
						{{ locale.noProductsSelected }}
					</p>
				}

				@for (
					orderItem of bookedItems.getOrderItems();
					track orderItem.uuid
				) {
					@if (
						orderItem.type === "MENU" ||
						orderItem.type === "SPECIAL"
					) {
						<app-offer-order-item-card
							[orderItem]="orderItem"
							(click)="transferItem(orderItem, bookedItems, activeBill)"
						></app-offer-order-item-card>
					} @else {
						<app-order-item-card
							[orderItem]="orderItem"
							(click)="transferItem(orderItem, bookedItems, activeBill)"
							(contextmenu)="showContextMenu($event, orderItem, true)"
						></app-order-item-card>
					}
				}
			</ul>
		</div>

		<div class="price-container">
			<p>{{ showTotal(bookedItems) }}</p>
		</div>
	</div>

	<div class="bills-price-container">
		<div class="bills-container">
			<app-headline [headline]="locale.billsHeadline">
				<dav-icon-button
					size="sm"
					[disabled]="checkMaxBills()"
					[tooltip]="locale.addBill"
					(click)="addBill()"
				>
					<fa-icon [icon]="faPlus"></fa-icon>
				</dav-icon-button>

				<dav-icon-button
					size="sm"
					[disabled]="bills.length <= 1"
					[tooltip]="locale.removeBill"
					(click)="removeBill()"
				>
					<fa-icon [icon]="faMinus"></fa-icon>
				</dav-icon-button>

				<dav-icon-button
					size="sm"
					[disabled]="activeBill.isEmpty()"
					[tooltip]="locale.payByCash"
					(click)="createBill('CASH')"
				>
					<fa-icon [icon]="faMoneyBill1Wave"></fa-icon>
				</dav-icon-button>

				<dav-icon-button
					size="sm"
					[disabled]="activeBill.isEmpty()"
					[tooltip]="locale.payByCard"
					(click)="createBill('CARD')"
				>
					<fa-icon [icon]="faCreditCard"></fa-icon>
				</dav-icon-button>
			</app-headline>

			<div class="bills-list-container">
				@for (bill of bills; let index = $index; track index) {
					<div>
						<button
							class="bill-select-button"
							[class.active]="bill === activeBill"
							(click)="setActiveBill(bill)"
						>
							{{ "Rechnung " + (index + 1) }}
						</button>

						<ul class="order-items-container">
							@if (!ordersLoading && bill.getOrderItems().length === 0) {
								<p class="no-products-message">
									{{ locale.noProductsSelected }}
								</p>
							}

							@for (
								orderItem of bill.getOrderItems();
								track orderItem.uuid
							) {
								@if (
									orderItem.type === "MENU" ||
									orderItem.type === "SPECIAL"
								) {
									<app-offer-order-item-card
										[orderItem]="orderItem"
										(click)="
											transferItem(
												orderItem,
												activeBill,
												bookedItems
											)
										"
									></app-offer-order-item-card>
								} @else {
									<app-order-item-card
										[orderItem]="orderItem"
										(click)="
											transferItem(
												orderItem,
												activeBill,
												bookedItems
											)
										"
										(contextmenu)="
											showContextMenu($event, orderItem, false)
										"
									></app-order-item-card>
								}
							}
						</ul>
					</div>
				}
			</div>
		</div>

		<div class="price-container">
			<p>{{ calculateTotalBills() }}</p>
		</div>
	</div>
</div>

<div class="popup-overlay" [ngClass]="{ visible: isItemPopupVisible }">
	<div class="popup-content">
		@if (tmpVariations != null) {
			<h2>
				{{ tmpVariations.product.name }}
			</h2>
			@for (
				variation of tmpVariations.orderItemVariations;
				track variation
			) {
				<div class="popup-content-dish">
					<button
						mat-mini-fab
						[disabled]="checkIfMinus(variation)"
						(click)="removeVariation(variation)"
					>
						<mat-icon>remove</mat-icon>
					</button>
					<b>
						{{ variation.count }}x
						@for (
							variationItem of variation.variationItems;
							track variationItem
						) {
							{{ variationItem.name }}
						}
					</b>
					<button
						mat-mini-fab
						[disabled]="checkIfPlus(variation)"
						(click)="addVariation(variation)"
					>
						<mat-icon>add</mat-icon>
					</button>
				</div>
			}
		}
		<button mat-flat-button (click)="closeItemPopup()">Schließen</button>
		<button
			mat-flat-button
			[disabled]="checkifVariationPicked()"
			(click)="transferVariation()"
		>
			Auswählen
		</button>
	</div>
</div>

<app-move-multiple-products-dialog
	#moveMultipleProductsDialog
	[orderItem]="contextMenuOrderItem"
	(primaryButtonClick)="moveMultipleProductsDialogPrimaryButtonClick($event)"
></app-move-multiple-products-dialog>

<dav-context-menu
	#contextMenu
	[visible]="contextMenuVisible"
	[posX]="contextMenuPositionX"
	[posY]="contextMenuPositionY"
>
	<dav-context-menu-item
		[value]="locale.moveMultipleProducts"
		(click)="showMoveMultipleProductsDialog()"
	>
		<fa-icon
			slot="icon"
			[icon]="contextMenuBillsList ? faChevronsRight : faChevronsLeft"
		></fa-icon>
	</dav-context-menu-item>
</dav-context-menu>
