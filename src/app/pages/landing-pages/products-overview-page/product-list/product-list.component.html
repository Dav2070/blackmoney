<div class="products-list">
	<ng-container *ngIf="products?.length > 0; else emptyState">
		<ng-container *ngFor="let product of products; trackBy: trackByUuid">
			<dav-card class="product-card">
				<div class="product-header">
					<div class="header-content">
						<h3>{{ product.name }}</h3>
						<span class="product-id">ID: {{ product.id }}</span>
					</div>
					<div class="product-actions">
						<dav-icon-button
							size="xs"
							[tooltip]="'Optionen'"
							(click)="showProductContextMenu($event, product)"
						>
							<fa-icon [icon]="faEllipsis"></fa-icon>
						</dav-icon-button>
					</div>
				</div>

				<div class="separator"></div>

				<div class="product-content">
					<div class="product-meta">
						<span class="price">{{
							product.price / 100 | currency: "EUR" : "symbol" : "1.2-2"
						}}</span>
						<ng-container *ngIf="product.takeaway">
							<span class="badge takeaway">Takeaway</span>
						</ng-container>
					</div>

					<ng-container
						*ngIf="product.variations?.length > 0; else noVariations"
					>
						<div class="variations-section">
							<strong>Variationen:</strong>
							<div class="variation-chips">
								<ng-container
									*ngFor="
										let variation of product.variations;
										trackBy: trackByUuid
									"
								>
									<div
										class="variation-chip"
										(mouseenter)="
											showVariationTooltip($event, variation)
										"
										(mouseleave)="scheduleHideVariationTooltip()"
									>
										<span class="variation-badge">{{
											variation.name
										}}</span>
									</div>
								</ng-container>
							</div>
						</div>
					</ng-container>
					<ng-template #noVariations>
						<p class="no-variations">Keine Variationen</p>
					</ng-template>
				</div>
			</dav-card>
		</ng-container>
	</ng-container>

	<ng-template #emptyState>
		<div class="empty-state">
			<p>Keine Produkte für {{ category?.name }}.</p>
		</div>
	</ng-template>

	<!-- Variation Tooltip Overlay -->
	<ng-container *ngIf="variationTooltipVisible">
		<div
			class="variation-tooltip-overlay"
			[style.left.px]="variationTooltipX"
			[style.top.px]="variationTooltipY"
			(mouseenter)="keepTooltipOpen()"
			(mouseleave)="scheduleHideVariationTooltip()"
		>
			<strong>{{ variationTooltipTitle }}</strong>
			<div class="variation-tooltip-items">
				<ng-container
					*ngFor="let item of variationTooltipItems; trackBy: trackByUuid"
				>
					<div class="variation-item">
						<span>{{ item.name }}</span>
						<span class="variation-price">
							+{{
								item.additionalCost / 100
									| currency: "EUR" : "symbol" : "1.2-2"
							}}
						</span>
					</div>
				</ng-container>
			</div>
		</div>
	</ng-container>

	<!-- Context Menu -->
	<dav-context-menu
		#productContextMenu
		[visible]="contextMenuVisible"
		[posX]="contextMenuX"
		[posY]="contextMenuY"
	>
		<dav-context-menu-item
			[value]="'Bearbeiten'"
			(click)="editSelectedProduct()"
		>
			<fa-icon slot="icon" [icon]="faPen"></fa-icon>
		</dav-context-menu-item>
		<dav-context-menu-item
			[value]="'Löschen'"
			(click)="deleteSelectedProduct()"
		>
			<fa-icon slot="icon" [icon]="faTrash"></fa-icon>
		</dav-context-menu-item>
	</dav-context-menu>
</div>
