<div class="container slide-up-in">
	<dav-card class="filters-card">
		<div class="guests-header">
			<div class="filter-item name-filter">
				<dav-textfield
					[value]="nameFilter"
					label="Name des Restaurants"
					(change)="nameTextfieldChange($any($event).detail.value)"
				></dav-textfield>
			</div>

			<div class="filter-item city-filter">
				<dav-textfield
					[value]="cityPostalFilter"
					label="Stadt / PLZ"
					(change)="cityTextfieldChange($any($event).detail.value)"
				></dav-textfield>
			</div>

			<div class="filter-item distance-filter">
				<label class="distance-label"
					>Entfernung: {{ distanceKm }} km</label
				>
				<input
					type="range"
					min="1"
					max="100"
					[value]="distanceKm"
					(input)="distanceRangeChange($any($event).target.value)"
				/>
			</div>

			<div class="filter-item rating-filter">
				<label>Bewertung</label>
				<div class="stars">
					@for (i of [1, 2, 3, 4, 5]; track i) {
						<fa-icon
							[icon]="faStar"
							class="star"
							[class.filled]="i <= ratingFilter"
							(click)="setRating(i)"
						></fa-icon>
					}
				</div>
			</div>

			<div class="filter-item checkboxes">
				<dav-checkbox
					[checked]="hasTakeaway"
					[label]="'Zum Mitnehmen'"
					(change)="takeawayCheckboxChange($any($event).detail.checked)"
				></dav-checkbox>

				<dav-checkbox
					[checked]="hasDelivery"
					[label]="'Lieferung'"
					(change)="deliveryCheckboxChange($any($event).detail.checked)"
				></dav-checkbox>
			</div>

			<div class="filter-item search-icon">
				<fa-icon
					[icon]="faSearch"
					class="search-button"
					(click)="search()"
					title="Suchen"
				></fa-icon>
			</div>
		</div>
	</dav-card>

	<dav-card class="restaurant-info-card">
		<div class="restaurant-info-grid">
			<div class="restaurant-info-left">
				<div class="restaurant-details">
					<h2 class="restaurant-name">{{ restaurant?.name }}</h2>

					<div class="restaurant-address">
						<p>{{ restaurant?.addressLine1 }}</p>
						<p>{{ restaurant?.postalCode }} {{ restaurant?.city }}</p>
					</div>

					<div class="restaurant-services">
						@if (restaurant?.hasTakeaway) {
							<fa-icon
								[icon]="faCupTogo"
								title="Zum Mitnehmen"
							></fa-icon>
						}
						@if (restaurant?.hasDelivery) {
							<fa-icon [icon]="faTruck" title="Lieferung"></fa-icon>
						}
					</div>

					<div class="restaurant-hours">
						<h3>Öffnungszeiten</h3>
						<p>Mo-Fr: 08:00 - 18:00</p>
						<p>Sa-So: 10:00 - 16:00</p>
					</div>

					<div class="restaurant-contact">
						<div class="contact-item">
							<strong>Telefon:</strong> +49 123 456789
						</div>
						<div class="contact-item">
							<strong>E-Mail:</strong> info@restaurant.de
						</div>
					</div>
				</div>

				<div class="restaurant-actions">
					<dav-button (click)="reserveTable()"
						>Jetzt reservieren</dav-button
					>
					<dav-button (click)="orderNow()">Jetzt bestellen</dav-button>
				</div>
			</div>

			<div class="restaurant-image-section">
				<div class="image-navigation">
					<fa-icon
						[icon]="faChevronLeft"
						class="nav-arrow nav-arrow-left"
						(click)="previousImage()"
					></fa-icon>

					<div class="image-container">
						@if (currentImageUrl) {
							<img
								[src]="currentImageUrl"
								alt="Restaurant"
								class="restaurant-image"
							/>
						} @else {
							<div class="image-placeholder">Kein Bild verfügbar</div>
						}
					</div>

					<fa-icon
						[icon]="faChevronRight"
						class="nav-arrow nav-arrow-right"
						(click)="nextImage()"
					></fa-icon>
				</div>

				<div class="image-indicators">
					@for (image of restaurant?.images || []; track $index) {
						<div
							class="indicator"
							[class.active]="$index === currentImageIndex"
							(click)="setCurrentImage($index)"
						></div>
					}
				</div>
			</div>
		</div>
	</dav-card>

	<div class="restaurant-details-grid">
		<dav-card class="menu-card">
			<h3>Menü</h3>
			<div class="menu-content">
				@if (menu?.categories && menu.categories.length > 0) {
					@for (category of menu.categories; track category.name) {
						<div class="menu-category">
							<h4>{{ category.name }}</h4>
							@for (product of category.products; track product.name) {
								<div class="menu-item">
									<span class="item-name">{{ product.name }}</span>
									<span class="item-price">{{ product.price | currency:'EUR':'symbol':'1.2-2' }}</span>
								</div>
							}
						</div>
					}
				} @else {
					<p>Keine Menüdaten verfügbar</p>
				}
			</div>
		</dav-card>

		<dav-card class="reviews-card">
			<h3>Bewertungen</h3>
			<div class="reviews-content">
				@if (ratings && ratings.length > 0) {
					<div class="average-rating">
						<strong>Durchschnitt: {{ calculateAverageRating() | number:'1.1-1' }}/5</strong>
						<div class="stars">
							@for (star of [1,2,3,4,5]; track star) {
								<fa-icon
									[icon]="faStar"
									[class.filled]="star <= calculateAverageRating()"
								></fa-icon>
							}
						</div>
					</div>
					<div class="reviews-list">
						@for (rating of ratings; track rating) {
							<div class="review-item">
								<div class="review-header">
									<span class="review-user">{{ rating.userName }}</span>
									<div class="review-stars">
										@for (star of [1,2,3,4,5]; track star) {
											<fa-icon
												[icon]="faStar"
												[class.filled]="star <= rating.value"
											></fa-icon>
										}
									</div>
								</div>
								<p class="review-text">{{ rating.review }}</p>
							</div>
						}
					</div>
				} @else {
					<p>Keine Bewertungen verfügbar</p>
				}
			</div>
		</dav-card>
	</div>
</div>
