<div class="container slide-up-in">
	<div class="content-container">
		<dav-header
			backButtonVisible
			addButtonVisible
			(backButtonClick)="navigateBack()"
			(addButtonClick)="showAddVariationDialog()"
		>
			{{ locale.headline }}
		</dav-header>

		<div class="separator"></div>

		<!-- Variationen-Liste -->
		@if (variations.length > 0) {
			@for (variation of variations; track variation.uuid) {
				<dav-card>
					<div class="variation-header">
						<h3>{{ variation.name }}</h3>
						<div class="variation-actions">
							<dav-icon-button
								size="xs"
								[tooltip]="locale.options"
								(click)="showVariationContextMenu($event, variation)"
							>
								<fa-icon [icon]="faEllipsis"></fa-icon>
							</dav-icon-button>
						</div>
					</div>

					<div class="separator"></div>

					<!-- VariationItems -->
					<div class="variation-items">
						@if (variation.variationItems?.length > 0) {
							@for (item of variation.variationItems; track item.uuid) {
								<div class="variation-item">
									<span>{{ item.name }}</span>
									<span class="item-price">{{
										item.additionalCost | currency: "EUR"
									}}</span>
									<div class="item-actions">
										<dav-icon-button
											size="xs"
											[tooltip]="locale.options"
											(click)="
												showVariationItemContextMenu(
													$event,
													variation,
													item
												)
											"
										>
											<fa-icon [icon]="faEllipsis"></fa-icon>
										</dav-icon-button>
									</div>
								</div>
							}
						} @else {
							<p class="no-items">{{ locale.noVariationItems }}</p>
						}
					</div>

					<dav-button
						class="add-item-button"
						(click)="showAddVariationItemDialog(variation)"
					>
						{{ locale.addVariationItem }}
					</dav-button>
				</dav-card>
			}
		} @else {
			<p class="no-variations">{{ locale.noVariations }}</p>
		}
	</div>

	<app-add-variation-dialog
		#addVariationDialog
		[loading]="false"
		(primaryButtonClick)="addVariationDialogPrimaryButtonClick($event)"
	></app-add-variation-dialog>

	<app-add-variation-item-dialog
		#addVariationItemDialog
		[loading]="false"
		(primaryButtonClick)="addVariationItemDialogPrimaryButtonClick($event)"
	></app-add-variation-item-dialog>

	<!-- Variation context menu -->
	<dav-context-menu
		#variationContextMenu
		[visible]="variationContextMenuVisible"
		[posX]="variationContextMenuX"
		[posY]="variationContextMenuY"
	>
		<dav-context-menu-item
			[value]="actionsLocale.edit"
			(click)="editSelectedVariation()"
		>
			<fa-icon slot="icon" [icon]="faPen"></fa-icon>
		</dav-context-menu-item>

		<dav-context-menu-item
			[value]="actionsLocale.delete"
			(click)="deleteSelectedVariation()"
		>
			<fa-icon slot="icon" [icon]="faTrash"></fa-icon>
		</dav-context-menu-item>
	</dav-context-menu>

	<!-- Variation item context menu -->
	<dav-context-menu
		#variationItemContextMenu
		[visible]="variationItemContextMenuVisible"
		[posX]="variationItemContextMenuX"
		[posY]="variationItemContextMenuY"
	>
		<dav-context-menu-item
			[value]="actionsLocale.edit"
			(click)="editSelectedVariationItem()"
		>
			<fa-icon slot="icon" [icon]="faPen"></fa-icon>
		</dav-context-menu-item>

		<dav-context-menu-item
			[value]="actionsLocale.delete"
			(click)="deleteSelectedVariationItem()"
		>
			<fa-icon slot="icon" [icon]="faTrash"></fa-icon>
		</dav-context-menu-item>
	</dav-context-menu>
</div>
